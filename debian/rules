#!/usr/bin/make -f

# TODO: find the build directory variable in debhelper, and use that here
PYTHON_BUILDDIR?=./
PYTHON_INSTALL_FLAGS=--install-layout=deb --root=$(PYTHON_BUILDDIR)

export PYTHONDONTWRITEBYTECODE=yes

%:
	dh $@

override_dh_auto_clean:
	dh_auto_clean
	rm -rf build
	rm -rf python_apps/airtime_analyzer/airtime_analyzer.egg-info
	python python_apps/airtime_analyzer/setup.py clean --all
	rm -rf python_apps/airtime-celery/airtime_celery.egg-info
	python python_apps/airtime-celery/setup.py clean --all
	rm -rf python_apps/api_clients/api_clients.egg-info
	python python_apps/api_clients/setup.py clean --all
	rm -rf python_apps/pypo/airtime_playout.egg-info
	python python_apps/pypo/setup.py clean --all

override_dh_auto_build:
	composer install --no-dev
	dh_auto_build
	python python_apps/airtime_analyzer/setup.py build
	python python_apps/airtime-celery/setup.py build
	python python_apps/api_clients/setup.py build
	python python_apps/pypo/setup.py build

override_dh_install:
	dh_install
	python python_apps/airtime_analyzer/setup.py install \
		--no-init-script --install-scripts=debian/libretime/usr/bin \
		$(PYTHON_INSTALL_FLAGS)
	python python_apps/airtime-celery/setup.py install \
		--no-init-script $(PYTHON_INSTALL_FLAGS)
	python python_apps/api_clients/setup.py install \
		--install-scripts=debian/libretime/usr/bin $(PYTHON_INSTALL_FLAGS)
	python python_apps/pypo/setup.py install \
		--no-init-script --install-scripts=debian/libretime/usr/bin \
		$(PYTHON_INSTALL_FLAGS)
	mkdir -p debian/libretime/etc/airtime
	mkdir -p debian/libretime/var/log/airtime
	mkdir -p debian/libretime/srv/airtime
